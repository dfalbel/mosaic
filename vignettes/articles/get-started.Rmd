---
title: "Get Started"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(mosaic)
```

Mosaic allows creating scalable and interactive data visualizations using the 
[Mosaic](https://idl.uw.edu/mosaic/) framework directly from R. You can use
Mosaic to create a wide range of visualizations.

## Installation

To install the Mosaic package, you can use the following command in R:

```R
pak::pkg_install("dfalbel/mosaic")
```

## Basic Usage

To create mosaic plots, use the `mosaic` function. First define a specification. The spec is a list that describes the plot(s) you want to create with mosaic as well as the data to be used and optionally more attributes. See the [specification documentation](https://idl.uw.edu/mosaic/api/spec/format.html) for more details.

At its simplest, a spec can be a list with a single plot definition. Here is an example of a simple scatter plot using the built-in `palmerpenguins` dataset:

```{r}
spec <- list(
  plot = list(
    list(
      mark = "dot",
      data = list(from = "penguins"),
      x = "body_mass",
      y = "flipper_len",
      stroke = list(column = "species"),
      symbol = list(column = "species")
    )
  )
)
```

Similar to other grammars, a plot consists of marks — graphical primitives such as bars, areas, and lines—which serve as chart layers. Mosaic uses the semantics of Observable Plot, such that each plot has a dedicated set of encoding channels with named scale mappings such as x, y, color, opacity, etc. See [marks API reference](https://idl.uw.edu/mosaic/api/vgplot/marks.html) for a full list of available marks and their channels.

```{r}
mosaic(
  spec,
  penguins = dplyr::sample_n(penguins, 50)
)
```

To add a legend, we modify the spec to include it. We add a `vconcat` property that adds a legend and a scatter plot. Notice we add a name to the plot so that the legend can refer to it.

```{r}
spec <- list(
  vconcat = list(
    list(
       legend = "symbol",
       "for" = "scatter"
    ),
    list(
      name  = "scatter",
      plot = list(list(
        mark = "dot",
        data = list(from = "penguins"),
        x = "body_mass",
        y = "flipper_len",
        stroke = list(column = "species"),
        symbol = list(column = "species")
      ))
    )
  )
)

mosaic(
  spec,
  penguins = dplyr::sample_n(penguins, 50)
)
```

## Loading data

You can also use the `data` attribute in the spec to load data asyncronously into the plot.
This is useful to acquire data from a remote source.

```{r}
spec <- list(
  meta=list(
    title="Airline Travelers",
    description="A labeled line chart comparing airport travelers in 2019 and 2020.",
    credit="Adapted from an [Observable Plot example](https://observablehq.com/@observablehq/plot-labeled-line-chart)."
  ),
  data=list(
    travelers = list(file="data/travelers.parquet"),
    endpoint = "SELECT * FROM travelers ORDER BY date DESC LIMIT 1\n"
  ),
  plot=list(
    list(mark="ruleY", data=c(0)),
    list(mark="lineY", data=list(from="travelers"), x="date", y="previous", strokeOpacity=0.35),
    list(mark="lineY", data=list(from="travelers"), x="date", y="current"),
    list(mark="text", data=list(from="endpoint"), x="date", y="previous", text=list("2019"), fillOpacity=0.5, lineAnchor="bottom", dy=-6),
    list(mark="text", data=list(from="endpoint"), x="date", y="current", text=list("2020"), lineAnchor="top", dy=6)
  ),
  yGrid=TRUE,
  yLabel="↑ Travelers per day",
  yTickFormat="s"
)

mosaic(spec)
```
